---
output: github_document
date: "Compiled at `r format(Sys.time(), '%Y-%m-%d %H:%M:%S', tz = 'UTC')` UTC"
params:
  publish: "workflow/data/99-publish"
---

<!-- README.md is generated from README.Rmd. Please edit that file -->

```{r, include = FALSE}
knitr::opts_chunk$set(
  echo = FALSE,
  message = FALSE,
  collapse = TRUE,
  comment = "#>",
  fig.path = "man/figures/README-",
  out.width = "100%"
)
```

# covidIowa

```{r}
library("conflicted")
library("readr")
library("glue")
library("dplyr")
library("scales")
library("lubridate")

conflict_prefer("filter", "dplyr")
```
<!-- badges: start -->
<!-- badges: end -->

The goal of this repository is to give a county-level summary of COVID-19 cases in Iowa. 
The data is taken from a series of daily snapshots of the [accessibility page](https://coronavirus.iowa.gov/pages/access) provided by the Iowa Department of Public Health.

I don't know if, in this case, **cases** means positive individuals or positive tests. 
All I know is that small numbers are good and big numbers are bad.

If you want to work with the data yourself, it's available here:

- [`iowa_county_meta.csv`](https://github.com/ijlyttle/covidIowa/blob/master/workflow/data/99-publish/iowa_county_meta.csv): county metadata, things like estimated 2019 population from [ICIP](https://www.icip.iastate.edu/tables/population/counties-estimates) at Iowa State University. 
- [`iowa_county_data.csv`](https://github.com/ijlyttle/covidIowa/blob/master/workflow/data/99-publish/iowa_county_data.csv): daily numbers by county from IDPH, going back to 2020-05-25.
- [`iowa_county_cases_week.csv`](https://github.com/ijlyttle/covidIowa/blob/master/workflow/data/99-publish/iowa_county_data.csv): In addition to county metadata, total cases (and per 100k), one week averages of new cases (and per 100k), and week-over-week change in cases (as a ratio).
- [`iowa_cases_week.csv`](https://github.com/ijlyttle/covidIowa/blob/master/workflow/data/99-publish/iowa_county_data.csv): Similar to `iowa_county_cases_week.csv`, but aggregated for the entire state.

## Plots

![](workflow/data/99-publish/iowa_cases.png)

![](workflow/data/99-publish/iowa_change.png)
```{r}
iowa_county_cases_week_current <- 
  read_csv(
    fs::path(params$publish, "iowa_county_cases_week.csv"), 
    col_types = cols(
      date = col_date(format = ""),
      fips = col_double(),
      county = col_character(),
      population = col_double(),
      population_group = col_character(),
      cases_total = col_double(),
      cases_total_per100k = col_double(),
      cases_avg_week = col_double(),
      cases_avg_week_per100k = col_double(),
      cases_week_growth = col_double()
    )
  ) %>%
  filter(date == max(date))
```

```{r}
iowa_cases_week <- 
  read_csv(fs::path(params$publish, "iowa_cases_week.csv")) %>%
  mutate(county = "")
```

```{r}
make_table <- function(.data, arr, n = 10, by = county) {
  
  .data %>%
  dplyr::arrange({{ arr }}) %>%
  head(n) %>%
  dplyr::transmute(
    {{ by }}, 
    `daily new cases` = round(cases_avg_week, 1),
    `daily new cases per 100k` = round(cases_avg_week_per100k, 1),
    `week-over-week change` = scales::label_percent(0.1)(cases_week_growth)
  ) %>%
  knitr::kable(align = "r")
}
```

## Tables as of `r unique(iowa_county_cases_week_current$date)`

For the entire state, over the past week:

```{r}
make_table(iowa_cases_week, desc(date), n = 7, by = date)
```

For the most-populated counties:

```{r}
make_table(iowa_county_cases_week_current, desc(population))
```

Most cases reported, per-capita:

```{r}
make_table(iowa_county_cases_week_current, desc(cases_avg_week_per100k))
```

Most growth in cases, week-over-week:

```{r}
make_table(iowa_county_cases_week_current, desc(cases_week_growth))
```

Biggest decline in cases, week-over-week:

```{r}
make_table(iowa_county_cases_week_current, cases_week_growth)
```
